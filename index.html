<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Lifance - Control de Gastos</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Lifance">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#2c3e50">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/Kikelong/lifance/refs/heads/main/images/logo.png">
  <link rel="icon" href="https://raw.githubusercontent.com/Kikelong/lifance/refs/heads/main/images/logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<div id="loginBox" class="container" style="display:flex; flex-direction:column; justify-content:center;">
  <h2>Bienvenido a Lifance</h2>
  <p class="subtitle">Tu control financiero personal</p>
  <button class="btn-google" onclick="login()">ğŸ”µ Ingresar con Google</button>
</div>

<div id="appContainer" class="container hidden">
  <div class="sticky-header">
    <h2 id="headerTitle" style="margin:0; font-size: 1.2rem;">Lifance</h2>
    <p id="userSubtitle" style="margin:0; font-size: 0.8rem; color: #888;">Cargando...</p>
  </div>

  <div id="view-stats" class="view-section hidden">
    <h3>Resumen por CategorÃ­as</h3>
    <div class="resumen-container">
        <div class="balance-card">Disponible <span id="disponible-stats">$ 0</span></div>
        <div class="resumen-grid">
            <div class="resumen-item">Ingresos <span id="totalIngresos-stats" class="text-ingreso">$ 0</span></div>
            <div class="resumen-item">Egresos <span id="totalEgresos-stats" class="text-egreso">$ 0</span></div>
        </div>
    </div>
    <div class="row">
        <select id="mesFiltroStats" onchange="cargarEstadisticas()"></select>
        <select id="anioFiltroStats" onchange="cargarEstadisticas()"></select>
    </div>

    
    <div id="statsContent">
      <div class="stat-header text-tc" style="background:#f1f1f1; padding:10px; font-weight:bold; margin-top:20px;">
          EGRESOS CON TARJETA DE CRÃ‰DITO ($ <span id="totalEgresosTC"></span>)
      </div>
      <div id="egresosTCDetalle"></div>
    </div>
    
  </div>









  
  <div id="view-home" class="view-section">
    

    <h3>Historial</h3>
    <div class="search-box">
        <input type="text" id="buscador" placeholder="Buscar categorÃ­a o comentario..." oninput="filtrarMovimientos()">
    </div>

    <div class="row" style="margin-top:10px;">
      <select id="mesFiltro" onchange="cargarMovimientos()"></select>
      <select id="anioFiltro" onchange="cargarMovimientos()"></select>
    </div>

    <div class="resumen-container">
        <div class="balance-card">Disponible <span id="disponible">$ 0</span></div>
        <div class="resumen-grid">
            <div class="resumen-item">Ingresos <span id="totalIngresos" class="text-ingreso">$ 0</span></div>
            <div class="resumen-item">Egresos <span id="totalEgresos" class="text-egreso">$ 0</span></div>
        </div>
    </div>

    <div id="listaMovimientos"></div>
  </div>

  <div id="view-pendientes" class="view-section hidden">
    <h3>Pagos Pendientes / Fijos</h3>
    <div style="background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #e67e22;">
        <h4 style="color:#e67e22; margin-top:0;">ğŸ“Œ Agregar Compromiso</h4>
        <div class="row">
            <select id="catPendiente"></select>
        </div>
        <div class="row">
            <input type="text" id="montoPendiente" inputmode="numeric" placeholder="Monto $ 0" oninput="formatearMonto(this)">
            <input type="date" id="fechaPendiente">
        </div>
        <input type="text" id="notaPendiente" placeholder="DescripciÃ³n (Ej: Internet)">
        <button class="btn-egreso" onclick="crearPendiente()" style="margin-top:10px;">+ Guardar en Pendientes</button>
    </div>
    <div class="row" style="margin-top:20px;">
      <select id="mesFiltroPend" onchange="cargarPendientesDB()"></select>
      <select id="anioFiltroPend" onchange="cargarPendientesDB()"></select>
    </div>
    <h4 style="margin-top: 25px;">Lista de Pendientes</h4>
    <div id="listaPendientes" style="margin-top:10px;"></div>
  </div>

  <div id="view-settings" class="view-section hidden">
    <h3>Mi Perfil</h3>
    <input type="text" id="inputNombreUsuario" placeholder="Tu nombre">
    <button class="btn-main" onclick="actualizarPerfil()">Guardar Cambios</button>

    <div style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin-top: 25px; border: 1px solid #eee;">
        <h4>Gestionar CategorÃ­as</h4>
        <div class="row">
            <select id="tipoNuevaCat" onchange="actualizarListaCategoriasEdit()">
                <option value="ingreso">Ingresos</option>
                <option value="egreso" selected>Egresos</option>
            </select>
            <input type="text" id="nombreNuevaCat" placeholder="Nombre Ej: Gimnasio">
        </div>
        <button class="btn-ingreso" onclick="crearCategoria()" style="margin-top:10px;">+ AÃ±adir CategorÃ­a</button>
        <div id="listaCategoriasEdit" style="margin-top:15px; max-height: 300px; overflow-y: auto;"></div>
    </div>

    <div style="display: flex; justify-content: space-between; align-items: center; background: var(--card-bg); padding: 15px; border-radius: 8px; margin-top: 20px; border: 1px solid var(--border-color);">
      <span>ğŸŒ™ Modo Oscuro</span>
      <label class="switch">
          <input type="checkbox" id="darkModeToggle" onclick="toggleDarkMode()">
          <span class="slider"></span>
      </label>
    </div>


    
    <button class="logout" onclick="logout()">Cerrar SesiÃ³n</button>
    <p style="text-align: center; color: #999; font-size: 0.75rem; margin-top: 20px;">Lifance v5.6</p>
  </div>

  <div id="modalTransferencia" class="modal-overlay hidden">
    <div class="modal-content">
        <h3 style="margin-top: 0;">Transferencia Interna</h3>
        <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">Mueve dinero entre tus bolsillos.</p>
        <label style="font-size: 0.8rem; font-weight: bold; color: #888;">ORIGEN:</label>
        <select id="transfOrigen" onchange="actualizarDestinoTransf()">
            <option value="CASH">ğŸ’µ CASH (Efectivo)</option>
            <option value="BANK">ğŸ›ï¸ BANK (Banco)</option>
        </select>
        <div style="text-align: center; margin: 5px 0; font-size: 1.2rem;">â¬‡ï¸</div>
        <label style="font-size: 0.8rem; font-weight: bold; color: #888;">DESTINO:</label>
        <input type="text" id="transfDestino" value="BANK" disabled style="background: #f0f0f0; color: #555;">
        <input type="text" id="montoTransf" inputmode="numeric" placeholder="Monto $ 0" oninput="formatearMonto(this)" style="margin-top: 15px; border: 2px solid var(--primary);">
        <div class="row">
            <button class="btn-main" onclick="ejecutarTransferencia()">Confirmar</button>
            <button class="logout" onclick="toggleModalTransf()" style="background: #95a5a6; margin-top: 15px;">Cerrar</button>
        </div>
    </div>
  </div>

  <div id="modalAddMovimiento" class="modal-overlay hidden">
    <div class="modal-content">
        <h3 style="margin-top: 0;">Nuevo Movimiento</h3>
        <div class="row">
          <input type="text" id="montoModal" inputmode="numeric" placeholder="$ 0" oninput="formatearMonto(this)" autocomplete="off">
          <input type="date" id="fechaModal">
        </div>
        <div class="row">
          <button id="btnIngresoModal" class="btn-ingreso" onclick="setTipoModal('ingreso')">INGRESO</button>
          <button id="btnEgresoModal" class="btn-egreso" onclick="setTipoModal('egreso')">EGRESO</button>
        </div>

        <select id="categoriaModal" class="hidden" onchange="detectarPendientesModal()"></select>

        <div id="selectorPendienteContainerModal" class="hidden">
            <p style="margin-top: 15px; margin-bottom: 5px; font-size: 0.85rem; color: #e67e22; font-weight: bold;">Vincular con pendiente:</p>
            <select id="pendienteVinculoModal" onchange="aplicarDatosPendienteModal()">
                <option value="">-- Escoger pendiente o "Otro" --</option>
            </select>
        </div>

        <div id="metodoPagoContainerModal" class="hidden">
            <p style="margin-top: 15px; margin-bottom: 5px; font-size: 0.85rem; color: #666;">MÃ©todo:</p>
            <div class="metodo-selector">
                <div class="metodo-option active" id="optCashModal" onclick="seleccionarMetodoModal('CASH')">ğŸ’µ CASH</div>
                <div class="metodo-option" id="optBankModal" onclick="seleccionarMetodoModal('BANK')">ğŸ“² EFT</div>
                <div class="metodo-option" id="optTCModal" onclick="seleccionarMetodoModal('TC')">ğŸ’³ TC</div>
            </div>
            <input type="hidden" id="metodoPagoModal" value="CASH">
        </div>

        <input type="text" id="notaModal" class="hidden" placeholder="Escribe un comentario (opcional)...">
        <button id="btnGuardarModal" class="btn-main hidden" onclick="guardarMovimientoModal()">Registrar Movimiento</button>
        <div class="row" style="margin-top: 15px;">
            <button class="logout" onclick="closeAddModal()" style="background: #95a5a6;">Cerrar</button>
        </div>
    </div>
  </div>

  <div id="fab-container">
      <div id="balance-popover" class="hidden">
          <div style="font-size: 0.8rem; color: #666; margin-bottom: 8px;">Saldos Detallados</div>
          
          <div style="margin-bottom: 8px;">
              <small>ğŸ’µ CASH</small>
              <div id="saldo-cash" style="font-weight: bold; color: var(--primary); font-size: 1.1rem;">$ 0</div>
          </div>
          
          <div style="margin-bottom: 8px;">
              <small>ğŸ›ï¸ BANK</small>
              <div id="saldo-bank" style="font-weight: bold; color: var(--primary); font-size: 1.1rem;">$ 0</div>
          </div>
          
          <div style="margin-bottom: 10px;">
              <small>ğŸ’³ CREDIT CARD</small>
              <div id="saldo-tc" style="font-weight: bold; color: var(--primary); font-size: 1.1rem;">$ 0</div>
          </div>
          
          <hr style="border:0; border-top:1px solid #eee; margin: 10px 0;">
          
          <button onclick="toggleModalTransf()" style="background: #3498db; color: white; padding: 10px; font-size: 0.75rem; margin: 0; border-radius: 6px;">ğŸ”„ Transferir Dinero</button>
      </div>
      <button onclick="toggleBalancePopover()" style="width: 56px; height: 56px; border-radius: 50%; background: var(--primary); color: white; border: none; font-size: 24px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; cursor: pointer; margin-bottom: 100px;">ğŸ’°</button>
  </div>
</div>

<div id="bottomNav" class="bottom-nav hidden">
    <div class="nav-item" onclick="cambiarVista('stats')" id="nav-stats"><i class="far fa-chart-bar"></i></div>
    <div class="nav-item active" onclick="cambiarVista('home')" id="nav-home"><i class="far fa-list"></i></div>
    <div class="nav-item floating" onclick="openAddModal()" id="nav-add"><i class="fas fa-plus"></i></div>
    <div class="nav-item" onclick="cambiarVista('pendientes')" id="nav-pendientes"><i class="far fa-clock"></i></div>
    <div class="nav-item" onclick="cambiarVista('settings')" id="nav-settings"><i class="far fa-user"></i></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="js/script.js"></script>

</body>
</html>
